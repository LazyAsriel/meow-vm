.func @add_recursive_tco
    .registers 4
    .const "add_recursive_tco"
    LOAD_INT 2, 1
    LT 2, 0, 2          
    JUMP_IF_TRUE 2, stop
    
    LOAD_INT 2, 1
    SUB 2, 0, 2         
    
    ADD 3, 1, 0         
    
    GET_GLOBAL 0, 0 
    
    TAIL_CALL 0, 0, 2, 2     
    
    RETURN 0

stop:
    RETURN 1
.endfunc

.func @main
    .registers 6 
    
    .const @add_recursive_tco
    .const "add_recursive_tco"
    .const "print"
    
    CLOSURE 0, 0
    SET_GLOBAL 1, 0

    LOAD_INT 4, 0
    LOAD_INT 5, 10000

loop_start:
    GE 0, 4, 5
    JUMP_IF_TRUE 0, loop_end

    LOAD_INT 1, 1000    
    LOAD_INT 2, 0       
    
    GET_GLOBAL 0, 1
    
    CALL 3, 0, 1, 2     

    LOAD_INT 0, 1
    ADD 4, 4, 0
    
    JUMP loop_start

loop_end:
    GET_GLOBAL 0, 2
    CALL_VOID 0, 3, 1
    
    HALT
.endfunc