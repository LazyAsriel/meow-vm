# File: benchmark.meow
# R0 = sum
# R1 = counter
# R2 = step
# R3 = limit
# R4 = temp comparison
# R5 = hàm print (MỚI)

.func @main
    .registers 6            # [CHANGE] Tăng lên 6 thanh ghi để chứa hàm print

    # [CHANGE] Khai báo hằng chuỗi tên hàm
    .const "print"          # Index 0

    # Setup
    LOAD_INT 0, 0           # sum = 0
    LOAD_INT 1, 0           # counter = 0
    LOAD_INT 2, 1           # step = 1
    LOAD_INT 3, 100000      # limit = 100,000

loop_start:
    # --- Loop Body ---
    ADD 0, 0, 2             # sum += step
    ADD 1, 1, 2             # counter += step
    
    # Check limit
    LT 4, 1, 3              # R4 = (counter < limit)
    JUMP_IF_TRUE 4, loop_start

    # --- [MỚI] IN KẾT QUẢ ---
    # Lấy hàm "print" từ Global nạp vào R5
    GET_GLOBAL 5, 0         
    
    # Gọi hàm print(sum) 
    # R5: chứa hàm
    # 0: Bắt đầu lấy tham số từ R0 (chính là sum)
    # 1: Số lượng tham số là 1
    CALL_VOID 5, 0, 1       

    HALT
.endfunc